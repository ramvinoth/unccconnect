"use strict";angular.module("atwork.utils",["ngRoute","ngMaterial"]).factory("appStorage",function(){return{get:function(n){return localStorage.getItem(n)},set:function(n,o){return localStorage.setItem(n,o)},remove:function(n){return localStorage.removeItem(n)}}}).factory("appPromise",[function(){return function(n){var o=Q.defer();return n(o),o.promise}}]).factory("appLocation",["$location",function(n){return n}]).factory("appWebSocket",[function(n){var o={conn:{},connect:function(){var n=this,o=window.io();o.on("connect",function(){}),o.on("disconnect",function(){n.connect()}),this.conn=o},reconnect:function(){this.conn.close(),this.connect()},close:function(){this.conn.close()}};return o.connect(),o}]).factory("appToast",["$mdToast",function(t){return function(n){var o=t.simple().content(n).action("OK").highlightAction(!1).position("top right");t.show(o)}}]).factory("appDialog",["$mdDialog",function(n){return n}]).factory("appDesktop",["$rootScope",function(o){var t=0,i=0;return{notify:function(n){t=void 0!==n.notificationsCount?n.notificationsCount:t,i=void 0!==n.messagesCount?n.messagesCount:i,o.badges={messageBadge:i},window.fluid&&(window.fluid.dockBadge=t+i,parseInt(window.fluid.dockBadge)<=0?window.fluid.dockBadge=void 0:(window.fluid.playSound("Sosumi"),window.fluid.playSound("Purr")))}}}]).directive("setFocus",["$timeout","$parse",function(c,e){return{link:function(n,o,t){if($(window).width()<=600)return!0;var i=e(t.setFocus);n.$watch(i,function(n){!0===n&&c(function(){o[0].focus()},800)})}}}]);
"use strict";angular.module("atwork.system",["ngRoute","ngMessages","ngResource","angularFileUpload","atwork.utils","angular-loading-bar","ngAnimate"]),angular.module("atwork.system").factory("tokenHttpInterceptor",["appStorage",function(t){return{request:function(e){return e.headers.Authorization="Bearer "+t.get("userToken"),e}}}]).factory("authInterceptorService",["$q","$location","$injector",function(t,r,a){return{responseError:function(e){403===e.status&&-1==e.config.url.indexOf("users/notifications")&&(a.get("appToast")("Please login to continue"),r.path("login"));return t.reject(e)}}}]).factory("appSearch",["$resource",function(e){var t=e("search/:keyword",{},{query:{isArray:!1}});return function(e){return t.query({keyword:e}).$promise}}]).config(["$httpProvider","$mdThemingProvider","cfpLoadingBarProvider",function(e,t,r){e.interceptors.push("authInterceptorService"),e.interceptors.push("tokenHttpInterceptor"),t.definePalette("amazingPaletteName",{50:"ffebee",100:"ffcdd2",200:"ef9a9a",300:"e57373",400:"ef5350",500:"f44336",600:"e53935",700:"d32f2f",800:"c62828",900:"b71c1c",A100:"ff8a80",A200:"ff5252",A400:"ff1744",A700:"d50000",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),t.theme("default").primaryPalette("amazingPaletteName").accentPalette("amazingPaletteName"),r.includeSpinner=!0,r.includeBar=!1}]);
"use strict";angular.module("atwork.settings",[]);
"use strict";angular.module("atwork.settings").controller("SettingsCtrl",["$scope","$rootScope","$routeParams","$timeout","appPosts","appAuth","appToast","appStorage","appLocation","appWebSocket","appUsersSearch","appSettings",function(s,t,e,n,a,o,r,i,p,c,u,g){g.fetch(function(t){s.systemSettings=t}),-1===o.getUser().roles.indexOf("admin")&&(r("Only an Administrator can change system's settings."),p.url("/")),s.save=function(t){new g.single(s.systemSettings).$save(function(t){t.success&&(r("Your settings are saved."),p.url("/"))})}}]);
"use strict";angular.module("atwork.settings").config(["$routeProvider","$locationProvider",function(t,e){t.when("/settings",{templateUrl:"/system/settings/views/settings.html",controller:"SettingsCtrl"}),e.html5Mode(!0)}]);
"use strict";angular.module("atwork.settings").factory("appSettings",["$resource","$rootScope",function(t,i){return{cache:{},single:t("system-settings/"),fetch:function(s){var n=this,r=n.single.get({},function(){for(var t in r.res.items){var e=r.res.items[t];n.cache[e.name]=e.value}return i.systemSettings=n.cache,!s||s(n.cache)})}}}]).factory("appSettingsValid",["appSettings","appLocation","$rootScope",function(t,e,s){return function(){return!!("/settings"===e.url()||"/logout"===e.url()||s.systemSettings&&s.systemSettings.domains&&s.systemSettings.workplace)||(e.url("/settings"),!1)}}]);
"use strict";angular.module("atwork.activities",["atwork.system"]);
"use strict";angular.module("atwork.blogs",["atwork.system"]);
"use strict";angular.module("atwork.chats",["atwork.system"]);
"use strict";angular.module("atwork.galleries",["atwork.system"]);
"use strict";angular.module("atwork.notifications",["atwork.system"]).run(["$rootScope","appLocation","appNotification","appWebSocket","appNotificationText",function(t,n,i,o,a){o.conn.on("notification",function(o){t.$broadcast("notification",o),t.$broadcast(o.notificationType,o),o&&(o.message=a(o).text,o.then=function(){o.postId?n.url("/post/"+o.postId):o.userId&&n.url("/profile/"+o.actor.username)},i.show(o))}),o.conn.on("system",function(o){t.$broadcast(o.notificationType,o)})}]);
"use strict";angular.module("atwork.posts",["atwork.system"]);
"use strict";angular.module("atwork.streams",["atwork.system"]);
"use strict";angular.module("atwork.users",["atwork.system"]).factory("appAuth",["$http","appStorage",function(e,t){return{isLoggedIn:function(){return t.get("userToken")},getToken:function(){return t.get("userToken")},refreshUser:function(n){e.get("/users/me").then(function(e){null==e.res&&(e=e.data);var r=angular.toJson(e.res.record);t.set("user",r),n(e.res.record)})},getUser:function(){var e=t.get("user");return e?angular.fromJson(e):{name:"unknown"}}}}]);
"use strict";angular.module("atwork.activities").controller("ActivitiesCtrl",["$scope","$rootScope","$routeParams","$timeout","appPosts","appActivities","appAuth","appToast","appStorage","appLocation","appWebSocket",function(t,a,e,o,s,i,c,p,r,n,d){t.lastUpdated=0,t.newActivitiesCount=0,t.actions=[];var u=e.userId,l=i.get({userId:u,timestamp:t.lastUpdated},function(){t.actions=l.res.records?l.res.records.concat(t.actions):t.actions,t.lastUpdated=Date.now()})}]);
"use strict";angular.module("atwork.blogs",["summernote"]).controller("BlogsCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","appBlogs","appBlogsFeed","resolvedBlogs","htmlToPlaintextFilter",function(i,t,a,o,n,e,l,d,s,r,c,m,u){i.content="",i.lastUpdated=0,i.postForm="",i.newFeedCount=0,i.feed=[],i.feedsFilter="",i.limitComments=!0,i.feedPage=0,i.showBack=!1,i.mentionsResults=[];i.detailPage=a.blogId;i.options={height:300,focus:!0,airMode:!1,toolbar:[["edit",["undo","redo"]],["headline",["style"]],["style",["bold","italic","underline","superscript","subscript","strikethrough","clear"]],["fontface",["fontname"]],["textsize",["fontsize"]],["fontclr",["color"]],["alignment",["ul","ol","paragraph","lineheight"]],["height",["height"]],["table",["table"]],["insert",["link","picture","video","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]]},i.content="Hello World",i.title="",angular.extend(i,m.config),function(t){var o=t.config||{};i.feedsFilter&&!o.append&&(i.feed=[]);o.append?i.feed=i.feed.concat(t.res.records):i.feed=t.res.records.concat(i.feed);i.noMorePosts=!t.res.morePages,i.lastUpdated=Date.now(),i.showBack=!1,i.timelinePage&&(i.feedTitle="Blogs")}(m),i.create=function(t,o){t&&new r.single({title:this.title,short_title:u(this.title).substr(0,20)+"...",content:this.content,short_desc:u(this.content).substr(0,50)+"..."}).$save(function(t){t.success?(t.res=angular.extend(t.res,{creator:n.getUser()}),d.url("/blog")):(i.failure=!0,e(t.res.message))})},i.viewBlog=function(t){d.url("/blog/"+t)};var b=function(t,n){_.each(i.feed,function(t,o){t._id==n.postId&&function(t){var o={postId:n.postId};if(i.detailPage&&t._id===a.postId&&(o.allowMarking=!0),t._id==n.postId)var e=r.single.get(o,function(){angular.extend(t,e.res.record)})}(t)})};t.$on("like",b),t.$on("unlike",b),t.$on("comment",b),i.doLike=function(o){o.liked=!0,r.single.like(o,function(t){angular.extend(o,t.res.record)})},i.undoLike=function(o){o.liked=!1,r.single.unlike(o,function(t){angular.extend(o,t.res.record)})},i.comment=function(t,o){if(t){var e=this.content;o.commentEnabled=!1,o.comments.unshift({creator:n.getUser(),content:e}),o.comment=e,r.single.comment(o,function(t){angular.extend(o,t.res.record),o.commentEnabled=!1})}},i.showLikers=function(t,o){r.single.likes({postId:o._id},function(e){appDialog.show({controller:["$scope","appDialog",function(t,o){t.users=e.res.records,t.hide=function(){o.hide()}}],templateUrl:"/modules/users/views/users-dialog.html",targetEvent:t})})}}]).controller("AddBlogCtrl"[function(t,o,e,n,i,a,l,d,s,r){t.title="Hello World"}]),angular.module("textAngularEditor",["textAngular","ngMaterial"]).config(["$provide",function(t){t.decorator("taOptions",["$delegate",function(t){return t.forceTextAngularSanitize=!0,t.keyMappings=[],t.toolbar=[["h1","h2","h3","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["html","insertImage","insertLink"]],t.classes={focussed:"",toolbar:"ta-toolbar",toolbarGroup:"ta-button-group",toolbarButton:"",toolbarButtonActive:"active",disabled:"disabled",textEditor:"ta-text-editor",htmlEditor:"md-input"},t}]),t.decorator("taTools",["$delegate",function(t){return t.h1.display='<md-button aria-label="Heading 1">H1</md-button>',t.h2.display='<md-button aria-label="Heading 2">H2</md-button>',t.h3.display='<md-button aria-label="Heading 3">H3</md-button>',t.p.display='<md-button aria-label="Paragraph">P</md-button>',t.pre.display='<md-button aria-label="Pre">pre</md-button>',t.quote.display='<md-button class="md-icon-button" aria-label="Quote"><md-icon md-font-set="material-icons">format_quote</md-icon></md-button>',t.bold.display='<md-button class="md-icon-button" aria-label="Bold"><md-icon md-font-set="material-icons">format_bold</md-icon></md-button>',t.italics.display='<md-button class="md-icon-button" aria-label="Italic"><md-icon md-font-set="material-icons">format_italic</md-icon></md-button>',t.underline.display='<md-button class="md-icon-button" aria-label="Underline"><md-icon md-font-set="material-icons">format_underlined</md-icon></md-button>',t.ul.display='<md-button class="md-icon-button" aria-label="Buletted list"><md-icon md-font-set="material-icons">format_list_bulleted</md-icon></md-button>',t.ol.display='<md-button class="md-icon-button" aria-label="Numbered list"><md-icon md-font-set="material-icons">format_list_numbered</md-icon></md-button>',t.undo.display='<md-button class="md-icon-button" aria-label="Undo"><md-icon md-font-set="material-icons">undo</md-icon></md-button>',t.redo.display='<md-button class="md-icon-button" aria-label="Redo"><md-icon md-font-set="material-icons">redo</md-icon></md-button>',t.justifyLeft.display='<md-button class="md-icon-button" aria-label="Align left"><md-icon md-font-set="material-icons">format_align_left</md-icon></md-button>',t.justifyRight.display='<md-button class="md-icon-button" aria-label="Align right"><md-icon md-font-set="material-icons">format_align_right</md-icon></md-button>',t.justifyCenter.display='<md-button class="md-icon-button" aria-label="Align center"><md-icon md-font-set="material-icons">format_align_center</md-icon></md-button>',t.justifyFull.display='<md-button class="md-icon-button" aria-label="Justify"><md-icon md-font-set="material-icons">format_align_justify</md-icon></md-button>',t.clear.display='<md-button class="md-icon-button" aria-label="Clear formatting"><md-icon md-font-set="material-icons">format_clear</md-icon></md-button>',t.html.display='<md-button class="md-icon-button" aria-label="Show HTML"><md-icon md-font-set="material-icons">code</md-icon></md-button>',t.insertLink.display='<md-button class="md-icon-button" aria-label="Insert link"><md-icon md-font-set="material-icons">insert_link</md-icon></md-button>',t.insertImage.display='<md-button class="md-icon-button" aria-label="Insert photo"><md-icon md-font-set="material-icons">insert_photo</md-icon></md-button>',t}])}]);
"use strict";angular.module("atwork.chats").controller("ChatsCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","appChats","appDialog","appDesktop",function(a,e,s,t,o,c,r,n,i,d,h,p){a.chats=[],a.actions={};var g={},u=function(){var s=0;_.each(a.chats,function(e){s+=e.unread}),p.notify({messagesCount:s})};a.message=function(e,s,a){var t;a?(a.unread=0,u(),t={chatId:a._id}):t={participants:[s._id,o.getUser()._id]},new d.single(t).$save(function(s){var t=s.res.record._id;g[s.res.record._id]=s.res.record,h.show({controller:["$scope","appDialog",function(a,e){u(),a.messages=s.res.record.messages,a.chatId=t,a.firstTime=!0,a.$on("chatMessage",function(e,s){a.$apply(function(){a.messages.unshift(s.chatMessage)}),i.conn.emit("markAccessed",{chatId:s.chatId,userId:o.getUser()._id})}),a.hide=function(){e.hide()},a.sendMessage=function(e){if(e){var s=a.message;a.message="",d.single.message({message:s,creator:o.getUser()._id,_id:a.chatId},function(e){a.messages.unshift(e.res.record.messages[0])})}}}],templateUrl:"/modules/chats/views/chat-dialog.html",targetEvent:e}).finally(function(){delete g[t]})})},a.updateChats=function(e){e=e||{};var s=d.single.get({},function(){e.reload&&(a.chats=[]),s.res.records.length&&(e.append?a.chats=a.chats.concat(s.res.records):a.chats=s.res.records.concat(a.chats)),u(),a.noMoreChats=!s.res.morePages,a.lastUpdated=Date.now()})},a.$on("chatMessage",function(e,s){g[s.chatId]||a.updateChats({reload:!0})})}]);
"use strict";angular.module("atwork.galleries").controller("GalleryCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","UploadService",function(r,t,e,a,o,i,c,n,s,p){r.photos=[{src:"http://farm9.staticflickr.com/8042/7918423710_e6dd168d7c_b.jpg",desc:"Image 01"},{src:"http://farm9.staticflickr.com/8449/7918424278_4835c85e7a_b.jpg",desc:"Image 02"},{src:"http://farm9.staticflickr.com/8457/7918424412_bb641455c7_b.jpg",desc:"Image 03"},{src:"http://farm9.staticflickr.com/8179/7918424842_c79f7e345c_b.jpg",desc:"Image 04"},{src:"http://farm9.staticflickr.com/8315/7918425138_b739f0df53_b.jpg",desc:"Image 05"},{src:"http://farm9.staticflickr.com/8461/7918425364_fe6753aa75_b.jpg",desc:"Image 06"}],r._Index=0,r.isActive=function(e){return r._Index===e},r.showPrev=function(){r._Index=0<r._Index?--r._Index:r.photos.length-1},r.showNext=function(){r._Index=r._Index<r.photos.length-1?++r._Index:0},r.showPhoto=function(e){r._Index=e},t.filesSrc=[],r.imageUpload=function(e){var a=e.target.files,o=!1;if(new Image,["jpeg","png","gif","jpg"].forEach(function(e){for(var t=0;t<a.length;t++){a[t].type.match("image/"+e)&&(o=!0)}}),o){p.setFilesToUpload(a);for(var t=0;t<a.length;t++){var i=a[t],c=new FileReader;c.onload=r.imageIsLoaded,c.readAsDataURL(i)}}else alert("file type should be .jpeg, .png, .jpg, .gif")},r.imageIsLoaded=function(e){r.$apply(function(){t.filesSrc=[],t.filesSrc.push(e.target.result),p.setFilesSrc(t.filesSrc)})},r.imagePop=function(e,t){appGalleryPop.showImagePop(e,t)}}]),angular.module("imageResizer",["imageupload"]).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|data|blob|chrome-extension):/),e.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|data|blob|chrome-extension):/)}]).controller("AppCtrl",["$scope",function(e){e.config={width:600,height:600,quality:1}}]);
"use strict";angular.module("atwork.notifications").controller("notificationsCtrl",["$scope","$rootScope","appLocation","appUsers","appNotification","appWebSocket","appNotificationText","appDesktop",function(o,i,t,n,a,s,c,f){o.notificationShown=!1,o.notificationCount=0,o.items=[],i.$on("notification",function(i,t){o.updateNotifications()}),o.showUserNotifications=function(i){o.notificationShown=!o.notificationShown},o.markRead=function(i){var t=n.notifications.get({notificationId:i._id},function(){t.res.notifications&&t.res.notifications.map(function(i){i.display=c(i)}),o.items=t.res.notifications,o.notificationCount=t.res.notifications.length});o.showUserNotifications()},o.updateNotifications=function(){var i=n.notifications.get({},function(){i.res.notifications&&i.res.notifications.map(function(i){i.display=c(i),i.post?i.href="/post/"+i.post._id:i.user&&(i.href="/profile/"+i.actor.username)}),o.items=i.res.notifications,o.notificationCount=i.res.notifications?i.res.notifications.length:0,f.notify({notificationsCount:o.notificationCount})})},o.updateNotifications()}]);
"use strict";angular.module("atwork.posts").controller("PostsCtrl",["$scope","$route","$rootScope","$routeParams","$timeout","$upload","appPosts","appAuth","appToast","appStorage","appLocation","appWebSocket","appUsersSearch","appPostsFeed","resolvedFeeds","UploadService","PopUpService",function(o,n,s,r,a,d,i,l,c,e,t,p,u,f,g,m,F){o.content="",o.lastUpdated=0,o.postForm="",o.newFeedCount=0,o.feed=[],o.feedsFilter="",o.limitComments=!0,o.feedPage=0,o.showBack=!1,o.mentionsResults=[],o.filesToUpload=m.getFilesToUpload,o.currUserId=l.getUser()._id,o.currUserRole=l.getUser().designation;var P,h=r.hashtag,v=(o.timelinePage=r.userId,o.detailPage=r.postId,o.streamPage=r.streamId);function U(e){var t=e.config||{};o.feedsFilter&&!t.append&&(o.feed=[]),t.append?o.feed=o.feed.concat(e.res.records):o.feed=e.res.records.concat(o.feed),o.noMorePosts=!e.res.morePages,o.lastUpdated=Date.now(),o.showBack=!1,o.timelinePage?o.feedTitle="Timeline":o.streamPage?o.feedTitle="":o.detailPage?o.feedTitle="Written by "+o.feed[0].creator.name:o.feedTitle="Global"}h&&(o.feedsFilter="#"+h),o.back=function(){history.go(-1)},o.loadMore=function(){o.feedPage++,o.lastUpdated=0,o.feed.push({spacer:!0}),o.updateFeed({append:!0})},o.updateFeed=function(e,t){e=e||{};f.getFeeds(angular.extend(e,r,{passedData:t,feedsFilter:o.feedsFilter,limitComments:o.limitComments,feedPage:o.feedPage,lastUpdated:o.lastUpdated}),function(e){angular.extend(o,e.config),U(e)})},angular.extend(o,g.config),U(g),o.$watch("feedsFilter",function(e,t){e!==t&&(o.feed=[]),a.cancel(P),P=a(function(){e?(o.noPosting=!0,o.updateFeed()):o.feedsFilterEnabled&&(o.lastUpdated=0,o.noPosting=!1,o.updateFeed()),o.feedsFilterEnabled=""!==o.feedsFilter},500)});var $=function(e,n){_.each(o.feed,function(e,t){e._id==n.postId&&function(e){var t={postId:n.postId};if(o.detailPage&&e._id===r.postId&&(t.allowMarking=!0),e._id==n.postId)var a=i.single.get(t,function(){angular.extend(e,a.res.record)})}(e)})};s.$on("like",$),s.$on("unlike",$),s.$on("comment",$),s.$on("feed",function(e,t){if(t.streamId||n.current.params.streamId){var a=n.current.params.streamId;a&&a===t.streamId?(o.newFeedCount++,o.$digest()):s.$broadcast("stream-message",t)}else o.newFeedCount++,o.$digest()}),o.reset=function(e){o.content="",s.filesSrc=[],angular.element("input[type='file']").val(null),a(function(){o.postForm.$setPristine(),o.postForm.$setUntouched()})};var I=null;o.checkMentions=function(e,t){if(e){var a=e.match(/@([A-Za-z0-9_]+)$/g);a&&1===a.length&&4<=a[0].length?u(a[0].replace("@",""),!1).then(function(e){o.mentionsResults=e.res.items}):o.mentionsResults=[],I=t;var n=angular.element(I);angular.element(".mentions-results").css({top:n.offset().top})}},o.replaceName=function(e){var t=angular.element(I);t.val(t.val().replace(/@([A-Za-z0-9_]+)$/g,"@"+e)+" "),a(function(){t.change(),t.focus(),o.mentionsResults=[]})},o.create=function(e,t){if(e){var a,n=m.getFilesToUpload();n&&0<n.length&&(a=n[0]);var s={content:this.content,stream:v,files:n};d.upload({url:"/posts/",arrayKey:"",file:a,data:s}).progress(function(e){parseInt(100*e.loaded/e.total)}).success(function(e,t,a,n){e.success?(e.res=angular.extend(e.res,{creator:l.getUser()}),o.updateFeed(),o.reset()):(o.failure=!0,c(e.res.message))})}},o.imagePop=function(e,t){F.imagePop(e,t)}}]);
"use strict";angular.module("atwork.streams").controller("StreamsPurposeCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","appStreams",function(a,e,t,r,s,n,o,u,c,m){var i=t.streamId;a.getStream=function(e){var t=m.single.get({streamId:e},function(){a.stream=t.res.record,a.stream.purpose=a.stream.purpose||"Set the stream's purpose here..."})},a.updateStreamPurpose=function(e){var t=m.single.get({streamId:i},function(){(t=angular.extend(t,a.stream)).$save(function(e){n("Stream purpose updated.")})})},i&&a.getStream(i)}]).controller("StreamsCtrl",["$scope","$rootScope","$routeParams","$timeout","appAuth","appToast","appStorage","appLocation","appWebSocket","appStreams",function(r,e,t,a,s,n,o,u,c,m){r.streams=[],r.actions={},r.clearThis=function(e){a(function(){},2e3)},r.processMoreStreams=function(t){a(function(){if("1"===t)r.createNew();else var e=m.single.get({streamId:t},function(){e.$subscribe({streamId:t},function(){r.updateStreams({reload:!0}),n("You have subscribed to the new stream."),u.url("/stream/"+t)})})},500)},r.unsubscribe=function(e){var t=e._id,a=m.single.get({streamId:t},function(){a.$unsubscribe({streamId:t},function(){r.updateStreams({reload:!0}),n("You have unsubscribed from that stream.")})})},r.updateStreams=function(e){e=e||{};var t=m.single.get({subscribed:!0},function(){e.reload&&(r.streams=[]),e.append?r.streams=r.streams.concat(t.res.records):r.streams=t.res.records.concat(r.streams),r.noMoreStreams=!t.res.morePages,r.lastUpdated=Date.now()}),a=m.single.get({unsubscribed:!0},function(){r.moreStreams=a.res.records})},r.createNew=function(){r.actions.createNew=!0},r.create=function(e){e?new m.single({title:this.newStreamName}).$save(function(e){e.success?(c.conn.emit("stream",e.res._id),r.actions.createNew=!1,r.updateStreams({reload:!0}),u.url("/stream/"+e.res._id)):(r.failure=!0,n(e.res.message))}):n("Bummer! Is the stream name good?")},e.$on("stream-message",function(e,t){angular.forEach(r.streams,function(e){t.streamId===e._id&&(e.unread=e.unread?e.unread++:1)}),r.$digest()}),r.clearBadge=function(e){e.unread=0},c.conn.on("stream",function(){n("Woot! There is a new stream available!"),r.updateStreams({reload:!0})}),r.updateStreams()}]);
"use strict";angular.module("atwork.users").controller("ActivationCtrl",["$rootScope","$scope","$routeParams","appUsers","appToast","appStorage","appLocation",function(r,s,e,o,n,a,t){new o.auth({userId:e.userId,activationCode:e.activationCode}).$save(function(e){e.success?(n("Yayy! Your account is now active!"),s.postLogin(e.res.record,e.res.token)):n(e.res.message)}),s.postLogin=function(e,s){var o=angular.toJson(e);a.set("user",o),a.set("userToken",s),r.$broadcast("loggedIn"),t.url("/")}}]).controller("PasswordCtrl",["$rootScope","$scope","$routeParams","appUsers","appToast","appStorage","appLocation",function(r,s,e,o,n,a,t){new o.auth({userId:e.userId,activationCode:e.activationCode}).$save(function(e){e.success?(n("You are now logged in!"),s.postLogin(e.res.record,e.res.token)):n(e.res.message)}),s.postLogin=function(e,s){var o=angular.toJson(e);a.set("user",o),a.set("userToken",s),r.$broadcast("loggedIn"),t.url("/profile/"+e.username+"/change-password")}}]).controller("SearchCtrl",["$scope","$routeParams","$location","$timeout","$upload","appUsers","appAuth","appToast","appUsersSearch",function(e,s,o,r,n,a,t,i,u){e.search="",e.doSearch=function(e){return u(e).then(function(e){return e.res.items})},e.goToUser=function(e){e&&e.username&&o.url("/profile/"+e.username)},e.clearSearch=function(){r(function(){e.search=""},500)}}]).controller("ProfileCtrl",["$scope","$routeParams","$location","$timeout","$upload","appUsers","appAuth","appToast","appPosts","profileData","resolvedFeeds","appPostsFeed","appLocation",function(n,s,e,o,r,a,t,i,u,c,l,d,p){var g=s.userId||t.getUser()._id;if(n.currUserId=t.getUser()._id,n.selfProfile=g===t.getUser()._id||g===t.getUser().username,!g)return e.url("/");n.editProfile=function(){n.editMode=!0},n.changePassword=function(){p.url("/profile/"+t.getUser().username+"/change-password")},n.cancelEditProfile=function(){n.editMode=!1},n.updateProfile=function(e){if(e){if(n.password&&n.password!==n.password2)return i("Passwords do not match.");var s=a.single.get({userId:g},function(){s.name=n.profile.name,s.designation=n.profile.designation,n.password&&(s.password=n.password),delete s.res,s.$update(function(e){e.success?(n.editMode=!1,n.password&&p.url("/profile/"+e.res.username)):(n.failure=!0,i(e.res.message))})})}else i("Something is missing.")};var f=function(e){g=e.res.record.username,e.res.profile=e.res.record,angular.extend(n,e.res)};function m(e){var s=e.config||{};n.feedsFilter&&!s.append&&(n.feed=[]),s.append?n.feed=n.feed.concat(e.res.records):n.feed=e.res.records.concat(n.feed),n.noMorePosts=!e.res.morePages,n.lastUpdated=Date.now(),n.showBack=!1}n.getProfile=function(){a.single.get({userId:g}).$promise.then(function(e){f(e)})},n.noPosting=!0,n.loadMore=function(){n.feedPage=n.feedPage||0,n.feedPage++,n.lastUpdated=0,n.feed.push({spacer:!0}),n.updateFeed({append:!0})},n.updateFeed=function(e){e=e||{};d.getFeeds(angular.extend(e,s,{limitComments:!0,feedPage:n.feedPage}),function(e){angular.extend(n,e.config),m(e)})},n.follow=function(){n.alreadyFollowing="",new a.single({userId:g}).$follow({userId:g},function(){o(function(){n.getProfile()},800)})},n.unfollow=function(){n.alreadyFollowing="",new a.single({userId:g}).$unfollow({userId:g},function(e){o(function(){n.getProfile()},800)})},n.$watch("avatar",function(){n.avatar&&n.avatar.length&&n.uploadAvatar(n.avatar)}),n.uploadAvatar=function(){if(!n.selfProfile)return!0;var e=n.avatar.pop();r.upload({url:"/users/"+g+"/avatar",file:e}).progress(function(e){parseInt(100*e.loaded/e.total)}).success(function(e,s,o,r){e&&e.success&&(n.profile.face=e.res.face)})},f(c),angular.extend(n,l.config),m(l)}]).controller("InviteCtrl",["$rootScope","$scope","appStorage","appLocation","appDialog","appUsers","appAuth","appToast",function(e,s,o,r,n,a,t,i){s.inviteOthers=function(e){n.show({controller:["$scope","appDialog",function(o,e){o.inviteDone=!1,o.doInvite=function(e){if(e){var s=t.getUser()._id;new a.single({userId:s,message:o.message,email:o.email,name:o.name}).$invite({userId:s},function(e){e.success?o.inviteDone=!0:i(e.res.message)})}},o.hide=function(){e.hide()}}],templateUrl:"/modules/users/views/users-invite-dialog.html",targetEvent:e})}}]).controller("LogoutCtrl",["$rootScope","appStorage","appLocation",function(e,s,o){s.remove("userToken"),s.remove("user"),e.$broadcast("loggedOut"),o.url("/login")}]).controller("LoginCtrl",["$scope","$rootScope","appUsers","appAuth","appToast","appStorage","appLocation","appDialog","$auth",function(n,a,o,e,t,r,i,s,u){n.authenticate=function(r){u.authenticate(r).then(function(e){var s=e.data;if(s.success){t("You have successfully signed in with "+r+"!");var o=s.res.record;n.postLogin(o,s.res.token),a.currUserId=o._id,a.currUserRoles=o.roles,a.currUserDesig=o.designation?o.designation:"user"}else t(s.res.message)}).catch(function(e){e.message?t(e.message):e.data?t(e.data.message+" status: "+e.status):t(e)})},n.reset=function(){n.name=n.email=n.password=n.password2=n.name=""},n.create=function(e){e?new o.single({email:this.email,name:this.name,username:this.username,designation:this.designation,password:this.password}).$save(function(e){n.registeredUserId=e.res._id,e.success?e.res&&e.res.record?(console.log("user response success : ",e.success),n.postLogin(e.res.record,e.res.token)):n.regDone=!0:(n.failure=!0,t(e.res.message))}):t("Something is missing.")},n.resendEmail=function(){new o.single({userId:n.registeredUserId}).$activate({userId:n.registeredUserId},function(){t("Success! An email has been sent to you again.")})},n.forgotPwd=function(e){s.show({controller:["$scope","appDialog",function(s,e){s.inviteDone=!1,s.doReset=function(e){e&&new o.single({email:s.email}).$resetPassword({email:s.email},function(e){e.success?s.submitDone=!0:t(e.res.message)})},s.hide=function(){e.hide()}}],templateUrl:"/modules/users/views/users-pwd-dialog.html",targetEvent:e})},n.login=function(e){e?new o.auth({email:this.email,password:this.password}).$save(function(e){if(e.success){t("You are now logged in.");var s=e.res.record;n.postLogin(s,e.res.token),a.currUserId=s._id,a.currUserRoles=s.roles,a.currUserDesig=s.designation?s.designation:"user"}else t(e.res.message)}):t("Something is missing.")},n.postLogin=function(e,s){var o=angular.toJson(e);r.set("user",o),r.set("userToken",s),a.$broadcast("loggedIn"),i.url("/")},e.isLoggedIn()&&i.url("/")}]).controller("UserSheet",["$scope","$mdBottomSheet","$location","appStorage",function(o,r,e,s){o.items=[{name:"Profile",icon:"fa-user",handler:function(){e.url("/profile/"+angular.fromJson(s.get("user")).username)}},{name:"Logout",icon:"fa-sign-out",handler:function(){e.url("/logout")}}],o.listItemClick=function(e){var s=o.items[e];r.hide(s),s.handler()}}]);
"use strict";angular.module("atwork.activities").factory("appActivities",["$resource",function(e){return e("activities/feed/:userId",{userId:"@_id"})}]);
"use strict";angular.module("atwork.blogs").factory("appBlogs",["$resource",function(e){return{single:e("blogs/:blogId/:action",{blogId:"@_id"},{like:{method:"POST",params:{action:"like"}},unlike:{method:"POST",params:{action:"unlike"}},comment:{method:"POST",params:{action:"comment"}},likes:{method:"GET",params:{action:"likes"}}}),feed:e("blogs/")}}]).filter("htmlToPlaintext",function(){return function(e){return(e=String(e).replace(/<[^>]+>/gm,"").replace(/&nbsp;/g,""))||""}}).filter("appBlogPostFormat",["$sce",function(a){return function(e){var t=new RegExp("#([A-Za-z0-9]+)","g");e=e.replace(t,function(e){return'<a href="/feed/'+e.replace("#","")+'">'+e+"</a>"});var n=new RegExp("@([A-Za-z0-9_]+)","g");e=e.replace(n,function(e){return'<a href="/profile/'+e.replace("@","")+'">'+e+"</a>"});var o=[{key:":)",value:"fa-smile-o"},{key:":|",value:"fa-meh-o"},{key:":(",value:"fa-frown-o"},{key:"(y)",value:"fa-thumbs-o-up"},{key:"(n)",value:"fa-thumbs-o-down"},{key:":+1",value:"fa-thumbs-up"},{key:"(h)",value:"fa-heart"},{key:"(i)",value:"fa-lightbulb-o"}];for(var i in o){var l=o[i].key,r=o[i].value;e=e.replace(l,'<md-inline-list-icon class="yellow fa {{emoticon}}"></md-inline-list-icon>'.replace("{{emoticon}}",r))}return a.trustAsHtml(e)}}]).factory("appBlogsFeed",["appBlogs","ngMeta","MetaTagsService",function(u,d,g){return{getBlogs:function(e,t){var n=(e=e||{}).userId,o=(e.hashtag,e.blogId),i=e.streamId,l=e.passedData,r=e;if(n){r.noPosting=!0,r.limitComments=!0;var a=u.timeline.get({userId:n,timestamp:r.lastUpdated,filter:r.feedsFilter,limitComments:r.limitComments,page:r.feedPage},function(){m(a)})}else if(i){r.limitComments=!0;var s=u.stream.get({streamId:i,timestamp:r.lastUpdated,filter:r.feedsFilter,limitComments:r.limitComments,page:r.feedPage},function(){m(s)})}else if(o){r.noFiltering=!0,r.noPosting=!0,r.noMorePosts=!0,delete r.limitComments;a=u.single.get({blogId:o,limitComments:r.limitComments,allowMarking:!0},function(){d.setTitle(a.res.record.title),d.setTag("description",a.res.record.short_desc);var e=a.res.record;g.setTags({title:"Tamizhans Social Network","og:type":"Blog","og:url":"http://www.tamizhans.com/blog/"+e._id,"og:title":e.title,"og:description":e.short_desc}),a.res.records=[a.res.record],m(a),r.lastUpdated=Date.now(),r.showBack=!0})}else{r.limitComments=!0;var c=u.feed.get({timestamp:r.lastUpdated,filter:r.feedsFilter,limitComments:r.limitComments,page:r.feedPage},function(){m(c)})}function m(e){r.lastUpdated=Date.now(),e.config=r,t(e)}l&&m(l),r.newFeedCount=0}}}]).directive("awBlogItem",["appBlogs","appWebSocket","appAuth","appDialog",function(o,e,i,l){return{templateUrl:"/modules/blogs/views/blog-row.html",controller:["$scope",function(e){e.doLike=function(t){t.liked=!0,o.single.like(t,function(e){angular.extend(t,e.res.record)})},e.undoLike=function(t){t.liked=!1,o.single.unlike(t,function(e){angular.extend(t,e.res.record)})},e.comment=function(e,t){if(e){var n=this.content;t.commentEnabled=!1,t.comments.unshift({creator:i.getUser(),content:n}),t.comment=n,o.single.comment(t,function(e){angular.extend(t,e.res.record),t.commentEnabled=!1})}},e.showLikers=function(e,t){o.single.likes({postId:t._id},function(n){l.show({controller:["$scope","appDialog",function(e,t){e.users=n.res.records,e.hide=function(){t.hide()}}],templateUrl:"/modules/users/views/users-dialog.html",targetEvent:e})})}}]}}]).directive("awBlogSingle",["appBlogs","appWebSocket","appAuth","appDialog",function(o,e,i,l){return{templateUrl:"/modules/blogs/views/blog-single.html",controller:["$scope",function(e){e.doLike=function(t){t.liked=!0,o.single.like(t,function(e){angular.extend(t,e.res.record)})},e.undoLike=function(t){t.liked=!1,o.single.unlike(t,function(e){angular.extend(t,e.res.record)})},e.comment=function(e,t){if(e){var n=this.content;t.commentEnabled=!1,t.comments.unshift({creator:i.getUser(),content:n}),t.comment=n,o.single.comment(t,function(e){angular.extend(t,e.res.record),t.commentEnabled=!1})}},e.showLikers=function(e,t){o.single.likes({postId:t._id},function(n){l.show({controller:["$scope","appDialog",function(e,t){e.users=n.res.records,e.hide=function(){t.hide()}}],templateUrl:"/modules/users/views/users-dialog.html",targetEvent:e})})}}]}}]);
"use strict";angular.module("atwork.chats").factory("appChats",["$resource",function(a){return{single:a("chats/:chatId/:action",{chatId:"@_id"},{message:{method:"POST",params:{action:"message"}},end:{method:"POST",params:{action:"end"}}})}}]);
"use strict";angular.module("atwork.galleries").factory("appGallery",["$resource",function(e){return{single:e("blogs/:blogId/:action",{blogId:"@_id"},{like:{method:"POST",params:{action:"like"}},unlike:{method:"POST",params:{action:"unlike"}},comment:{method:"POST",params:{action:"comment"}},likes:{method:"GET",params:{action:"likes"}}}),feed:e("blogs/")}}]).directive("awGalleryPop",["appGallery","appWebSocket","appAuth","appDialog",function(e,t,i,n){return{templateUrl:"/modules/galleries/views/popup.html",controller:["$scope",function(e){}]}}]).factory("appGalleryPop",["appGallery","appWebSocket","appAuth","appDialog",function(e,t,i,n){return{showPopImage:function(e,i){n.show({controller:["$scope","appDialog",function(t,e){t.photos=[],t._Index=0,t.isActive=function(e){return t._Index===e},t.showPrev=function(){t._Index=0<t._Index?--t._Index:t.photos.length-1},t.showNext=function(){t._Index=t._Index<t.photos.length-1?++t._Index:0},t.showPhoto=function(e){t._Index=e},t.photos.push({src:i}),t.hide=function(){e.hide()}}],templateUrl:"/modules/galleries/views/popup.html",targetEvent:e})}}}]).directive("image",function(n){var p=window.URL||window.webkitURL,c=function(e,t){var i,n,o=t.resizeMaxHeight||300,a=t.resizeMaxWidth||250,r=t.resizeQuality||.7,l=t.resizeType||"image/jpg",p=(i="fileupload-resize-area",(n=document.getElementById(i))||((n=document.createElement("canvas")).id=i,n.style.visibility="hidden",document.body.appendChild(n)),n),c=e.height,u=e.width;return c<u?a<u&&(c=Math.round(c*=a/u),u=a):o<c&&(u=Math.round(u*=o/c),c=o),p.width=u,p.height=c,p.getContext("2d").drawImage(e,0,0,u,c),p.toDataURL(l,r)},u=function(e){var t=n.defer(),i=new FileReader;return i.onload=function(e){t.resolve(e.target.result)},i.readAsDataURL(e),t.promise};return{restrict:"A",scope:{image:"=",resizeMaxHeight:"@?",resizeMaxWidth:"@?",resizeQuality:"@?",resizeType:"@?"},link:function(a,e,o,t){var r=function(i,n){var e,t,o;e=i.url,t=function(e){var t=c(e,a);i.resized={dataURL:t,type:t.match(/:(.+\/.+);/)[1]},n(i)},(o=new Image).onload=function(){t(o)},o.src=e},l=function(e){a.$apply(function(){o.multiple?a.image.push(e):a.image=e})};e.bind("change",function(e){o.multiple&&(a.image=[]);for(var t=e.target.files,i=0;i<t.length;i++){var n={file:t[i],url:p.createObjectURL(t[i])};u(t[i]).then(function(e){n.dataURL=e}),a.resizeMaxHeight||a.resizeMaxWidth?r(n,function(e){l(e)}):l(n)}})}}}).service("PopUpService",["appGalleryPop",function(i,e,t){return{imagePop:function(e,t){i.showPopImage(e,t)}}}]);
"use strict";angular.module("atwork.notifications").factory("appNotification",["$resource","$mdToast",function(t,i){return{show:function(t){if(t.message){var o=i.simple().content(t.message).action("VIEW").highlightAction(!1).position("bottom right");i.show(o).then(function(){t.then&&t.then()}),window.fluid&&window.fluid.showGrowlNotification({title:"Atwork",description:t.message,priority:1,sticky:!1,identifier:"foo",onclick:function(){},icon:imgEl})}}}}]).factory("appNotificationText",[function(){return function(t){if(!t)return{text:""};var o="",i=t.actor;switch(t.notificationType){case"like":o=i.name+" has liked a post";break;case"comment":o=i.name+" has commented on a post";break;case"follow":o=i.name+" is now following you";break;case"mention":o=i.name+" mentioned you in a post"}return{text:o}}}]);
"use strict";angular.module("atwork.posts").factory("appPosts",["$resource",function(e){return{single:e("posts/:postId/:action",{postId:"@_id"},{like:{method:"POST",params:{action:"like"}},unlike:{method:"POST",params:{action:"unlike"}},comment:{method:"POST",params:{action:"comment"}},likes:{method:"GET",params:{action:"likes"}},delete:{method:"DELETE",params:{action:"delete"}}}),feed:e("posts/"),stream:e("posts/stream/:streamId"),timeline:e("posts/timeline/:userId")}}]).filter("appPostFormat",["$sce","appPostsFeed",function(l,m){return function(e){var t=new RegExp("#([A-Za-z0-9]+)","g");e=e.replace(t,function(e){return'<a href="/feed/'+e.replace("#","")+'">'+e+"</a>"});var n=new RegExp("@([A-Za-z0-9_]+)","g");e=(e=e.replace(n,function(e){return'<a href="/profile/'+e.replace("@","")+'">'+e+"</a>"})).replace(new RegExp("\r?\n","g"),"<br />");var o=[{key:":)",value:"fa-smile-o"},{key:":|",value:"fa-meh-o"},{key:":(",value:"fa-frown-o"},{key:"(y)",value:"fa-thumbs-o-up"},{key:"(n)",value:"fa-thumbs-o-down"},{key:":+1",value:"fa-thumbs-up"},{key:"(h)",value:"fa-heart"},{key:"(i)",value:"fa-lightbulb-o"}];for(var r in o){var a=o[r].key,i=o[r].value;e=e.replace(a,'<md-inline-list-icon class="yellow fa {{emoticon}}"></md-inline-list-icon>'.replace("{{emoticon}}",i))}var s=m.getVideoId(e);""!==s&&"error"!==s&&(e=e+"<br><br>"+('<iframe width="100%" height="auto" src="//www.youtube.com/embed/'+s+'" frameborder="0" allowfullscreen></iframe>'));return e=e.replace(/(\b(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[\-A-Z09+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>'),l.trustAsHtml(e)}}]).filter("appPostByPassFilter",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).factory("appPostsFeed",["appPosts","ngMeta","MetaTagsService",function(u,d,p){return{getFeeds:function(e,t){var n=(e=e||{}).userId,o=(e.hashtag,e.postId),r=e.streamId,a=e.passedData,i=e;if(n){i.noPosting=!0,i.limitComments=!0;var s=u.timeline.get({userId:n,timestamp:i.lastUpdated,filter:i.feedsFilter,limitComments:i.limitComments,page:i.feedPage},function(){c(s)})}else if(r){i.limitComments=!0;var l=u.stream.get({streamId:r,timestamp:i.lastUpdated,filter:i.feedsFilter,limitComments:i.limitComments,page:i.feedPage},function(){c(l)})}else if(o){i.noFiltering=!0,i.noPosting=!0,i.noMorePosts=!0,delete i.limitComments;s=u.single.get({postId:o,limitComments:i.limitComments,allowMarking:!0},function(){d.setTitle(s.res.record.stream.title),d.setTag("description",s.res.record.content);var e=s.res.record;p.setTags({title:"Tamizhans Social Network","og:type":"Post","og:url":"http://www.tamizhans.com/post/"+e._id,"og:title":e.stream.title,"og:description":e.content}),s.res.records=[s.res.record],c(s),i.lastUpdated=Date.now(),i.showBack=!0})}else{i.limitComments=!0;var m=u.feed.get({timestamp:i.lastUpdated,filter:i.feedsFilter,limitComments:i.limitComments,page:i.feedPage},function(){c(m)})}function c(e){i.lastUpdated=Date.now(),e.config=i,t(e)}a&&c(a),i.newFeedCount=0},getVideoId:function(e){var t="";return void 0!==(e=e.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/))[2]&&(t=(t=e[2].split(/[^0-9a-z_\-]/i))[0]),t}}}]).directive("awFeedItem",["appPosts","appWebSocket","appAuth","appToast","appDialog","appLocation",function(o,e,r,n,a,t){return{templateUrl:"/modules/posts/views/post-single.html",controller:["$scope",function(e){e.doLike=function(t){t.liked=!0,o.single.like(t,function(e){angular.extend(t,e.res.record)})},e.undoLike=function(t){t.liked=!1,o.single.unlike(t,function(e){angular.extend(t,e.res.record)})},e.comment=function(e,t){if(e){var n=this.content;t.commentEnabled=!1,t.comments.unshift({creator:r.getUser(),content:n}),t.comment=n,o.single.comment(t,function(e){angular.extend(t,e.res.record),t.commentEnabled=!1})}},e.deleteItem=function(t){o.single.delete({postId:t._id},function(e){1==e.success?(angular.element(document.querySelector('[id="'+t._id+'"]')).remove(),n(e.res.message)):alert("Error in deleting the post")})},e.showLikers=function(e,t){o.single.likes({postId:t._id},function(n){a.show({controller:["$scope","appDialog",function(e,t){e.users=n.res.records,e.hide=function(){t.hide()}}],templateUrl:"/modules/users/views/users-dialog.html",targetEvent:e})})}}]}}]).service("uploadService",function(t,n){return{upload:function(e){return t({method:"POST",url:"http://jsonplaceholder.typicode.com/posts",headers:{"Content-Type":"multipart/form-data"},data:{upload:e},transformRequest:function(e,t){var n=new FormData;angular.forEach(e,function(e,t){n.append(t,e)});var o=t();return delete o["Content-Type"],n}}).then(r,o)}};function o(e,t){return angular.isObject(e.data)&&e.data.message?n.reject(e.data.message):n.reject("An unknown error occurred.")}function r(e){return e}});
"use strict";angular.module("atwork.streams").factory("appStreams",["$resource",function(s){return{single:s("streams/:streamId/:action",{streamId:"@_id"},{subscribe:{method:"POST",params:{action:"subscribe"}},unsubscribe:{method:"POST",params:{action:"unsubscribe"}}})}}]);
"use strict";angular.module("atwork.users").factory("appUsers",["$resource",function(r){return{single:r("users/:userId/:action",{userId:"@_id"},{update:{method:"PUT"},follow:{method:"POST",params:{action:"follow"}},unfollow:{method:"POST",params:{action:"unfollow"}},activate:{method:"POST",params:{action:"activate"}},invite:{method:"POST",params:{action:"invite"}},resetPassword:{method:"POST",params:{action:"resetPassword"}}}),auth:r("users/authenticate"),notifications:r("users/notifications/:notificationId")}}]).factory("appUsersSearch",["$resource",function(r){var a=r("users/search/:keyword",{},{query:{isArray:!1}});return function(r,e){var o={keyword:r};return e&&(o.onlyUsernames=!0),a.query(o).$promise}}]).factory("follow");
"use strict";angular.module("atwork.activities").config(["$routeProvider","$locationProvider",function(o,i){i.html5Mode(!0)}]);
"use strict";function resolvedBlogs(r){return["$route","appBlogsFeed",function(l,e){var o=Q.defer(),s=angular.extend({limitComments:r.limitComments},l.current.params);return e.getBlogs(s,function(l){o.resolve(l)}),o.promise}]}angular.module("atwork.blogs").config(["$routeProvider","$locationProvider",function(l,e){l.when("/blog",{templateUrl:"/modules/blogs/views/blogs.html",controller:"BlogsCtrl",resolve:{resolvedBlogs:resolvedBlogs({limitComments:!0})}}).when("/blog/add",{templateUrl:"/modules/blogs/views/add-blog.html",controller:"BlogsCtrl",resolve:{resolvedBlogs:resolvedBlogs({limitComments:!0,makeCall:!1})}}).when("/blog/:blogId",{templateUrl:"/modules/blogs/views/blog-single.html",controller:"BlogsCtrl",resolve:{resolvedBlogs:resolvedBlogs({limitComments:!1})},meta:{disableUpdate:!0}}),e.html5Mode(!0)}]);
"use strict";angular.module("atwork.chats").config(["$routeProvider","$locationProvider",function(o,r){r.html5Mode(!0)}]);
"use strict";angular.module("atwork.galleries").config(["$routeProvider","$locationProvider",function(l,e){l.when("/gallery",{templateUrl:"/modules/galleries/views/gallery.html",controller:"GalleryCtrl"}).when("/gallery/add",{templateUrl:"/modules/galleries/views/gallery.html",controller:"GalleryCtrl"}).when("/gallery/:blogId",{templateUrl:"/modules/galleries/views/popup.html",controller:"GalleryCtrl"}),e.html5Mode(!0)}]);
"use strict";function resolvedFeeds(l){return["$route","appPostsFeed",function(e,s){var t=Q.defer(),o=angular.extend({limitComments:l.limitComments},e.current.params);return s.getFeeds(o,function(e){t.resolve(e)}),t.promise}]}angular.module("atwork.posts").config(["$routeProvider","$locationProvider",function(e,s){e.when("/feed",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:resolvedFeeds({limitComments:!0})}}).when("/",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:resolvedFeeds({limitComments:!0})}}).when("/post/:postId",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:resolvedFeeds({limitComments:!1})},meta:{disableUpdate:!0}}).when("/feed/:hashtag",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:resolvedFeeds({limitComments:!0})}}),s.html5Mode(!0)}]);
"use strict";angular.module("atwork.streams").config(["$routeProvider","$locationProvider",function(e,r){e.when("/stream/migration",{resolve:{resolvedFeeds:["$route","$resource",function(e,r){r("/streams/migration").save({},function(){})}]}}).when("/stream/:streamId",{templateUrl:"/modules/posts/views/feed.html",controller:"PostsCtrl",resolve:{resolvedFeeds:["$route","appPostsFeed",function(e,r){var t=Q.defer(),o=angular.extend({limitComments:!0},e.current.params);return r.getFeeds(o,function(e){t.resolve(e)}),t.promise}]}}),r.html5Mode(!0)}]);
"use strict";angular.module("atwork.users").config(["$routeProvider","$locationProvider",function(e,r){e.when("/login",{templateUrl:"/modules/users/views/login.html?v",controller:"LoginCtrl"}).when("/logout",{templateUrl:"/modules/users/views/login.html?v",controller:"LogoutCtrl"}).when("/activate/:userId/:activationCode",{templateUrl:"/modules/users/views/activating.html",controller:"ActivationCtrl"}).when("/changePassword/:userId/:activationCode",{templateUrl:"/modules/users/views/change-password.html",controller:"PasswordCtrl"}).when("/profile/:userId/change-password",{templateUrl:"/modules/users/views/change-password.html",controller:"ProfileCtrl",resolve:{profileData:["$route","appAuth","appUsers",function(e,r,t){var o=e.current.params.userId||r.getUser()._id;return t.single.get({userId:o}).$promise}],resolvedFeeds:["$route","appPostsFeed",function(e,r){var t=Q.defer(),o=angular.extend({feedPage:0},e.current.params);return r.getFeeds(o,function(e){t.resolve(e)}),t.promise}]}}).when("/profile/:userId",{templateUrl:"/modules/users/views/profile.html?v",controller:"ProfileCtrl",resolve:{profileData:["$route","appAuth","appUsers",function(e,r,t){var o=e.current.params.userId||r.getUser()._id;return t.single.get({userId:o}).$promise}],resolvedFeeds:["$route","appPostsFeed",function(e,r){var t=Q.defer(),o=angular.extend({feedPage:0},e.current.params);return r.getFeeds(o,function(e){t.resolve(e)}),t.promise}]}}).when("/me",{templateUrl:"/modules/users/views/profile.html?v",controller:"ProfileCtrl"}),r.html5Mode(!0)}]);
var app=angular.module("AtWork",["atwork.system","atwork.users","atwork.posts","atwork.streams","atwork.blogs","atwork.galleries","atwork.chats","atwork.activities","atwork.notifications","atwork.settings","ngMaterial","ngMeta","satellizer"]).config(["$qProvider","$routeProvider","ngMetaProvider","$authProvider",function(e,t,o,n){e.errorOnUnhandledRejections(!1),o.setDefaultTitle("First ever social network for Tamizhans"),o.setDefaultTag("description","Taking TN to the next level"),n.facebook({clientId:"183663679128594",url:"/users/auth/facebook",redirectUri:window.location.origin+"/login/oauth",scope:["public_profile","email"]}),n.loginUrl="/login/oauth"}]).service("MetaTagsService",function(){this.setDefaultTags=function(e){angular.copy(e,t),o({})},this.setTags=o;var t={},n=[];function o(e){var o;angular.forEach(n,function(e){document.head.removeChild(e)}),n.length=0,o=e,angular.forEach(t,function(e,t){o[t]?"title"===t&&(o.title+=" - "+e):o[t]=e}),angular.forEach(e,function(e,t){var o=function(e,t){{if("title"==t){var o=document.createElement("title");return o.textContent=e,o}var n=0===t.indexOf("og:")?"property":"name",i=document.createElement("meta");return i.setAttribute(n,t),i.setAttribute("content",e),i}}(e,t);document.head.appendChild(o),n.push(o)})}}).run(["ngMeta","MetaTagsService",function(e,t){e.init(),t.setDefaultTags({"og:title":"First ever social network for Tamizhans",author:"admin","og:description":"Taking TN to the next level","og:type":"website","og:app_id":"183663679128594","og:image":"http://www.tamizhans.com/images/anbendru_bharathiaar.png","og:image:width":"680","og:image:height":"340",googlebot:"all",bingbot:"all",robots:"all","og:site_name":"Tamizhans Social Network","twitter:site":"@tamizhans"})}]);app.controller("AppCtrl",["$scope","$route","$rootScope","$mdMedia","$mdSidenav","$mdBottomSheet","$location","$timeout","appLocation","appAuth","appWebSocket","appSettings","appSettingsValid","appToast",function(t,e,o,n,i,a,r,s,l,c,u,g,d,f){t.barTitle="",t.search="",t.showSideNav=!0,t.toggleSidenav=function(e){t.showSideNav=!t.showSideNav,n("gt-sm")||i(e).toggle()},t.updateLoginStatus=function(){t.isLoggedIn=c.isLoggedIn(),t.user=c.getUser(),o.currUserId=t.user._id,o.currUserRoles=t.user.roles,o.currUserDesig=t.user.designation?t.user.designation:"user",o.isAdmin=!!c.getUser().roles&&-1!==c.getUser().roles.indexOf("admin")},t.goHome=function(){l.url("/")},t.showUserActions=function(e){a.show({templateUrl:"/modules/users/views/user-list.html",controller:"UserSheet",targetEvent:e}).then(function(e){t.alert=e.name+" clicked!"})};var h=function(t){g.fetch(function(e){o.systemSettings=e,t&&t()})};t.$on("$routeChangeSuccess",function(){angular.element("*[md-scroll-y]").animate({scrollTop:0},300),i("left").close()}),t.$on("loggedIn",function(){t.updateLoginStatus(),t.barTitle="",t.$broadcast("updateNotifications"),u.conn.emit("online",{token:c.getToken()}),c.refreshUser(function(e){t.user=e}),h(function(){t.$on("$routeChangeStart",function(e,t){d()||f("Please complete the setup first.")}),t.appReady=!0,t.barTitle=o.systemSettings.tagline,s(d)})}),t.$on("loggedOut",function(){t.updateLoginStatus(),u.conn.emit("logout",{token:c.getToken()})}),u.conn.on("connect",function(){c.isLoggedIn()&&u.conn.emit("online",{token:c.getToken()})}),t.updateLoginStatus(),s(function(){c.isLoggedIn()?(t.barTitle="",t.$broadcast("loggedIn")):(-1==window.location.href.indexOf("/activate/")&&-1==window.location.href.indexOf("/changePassword/")&&-1==window.location.href.indexOf("/blog/")&&window.location.href.indexOf("/post/")&&-1==window.location.href.indexOf("/login/oauth")&&l.url("/login"),h(),t.appReady=!0)})}]),app.factory("UploadService",function(){return{getFilesSrc:function(){return this.filesToUpload},setFilesSrc:function(e){this.filesSrc=e},getFilesToUpload:function(){return this.filesToUpload},setFilesToUpload:function(e){this.filesToUpload=e},clearFilesSrc:function(e){this.filesSrc=[]}}});